!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.BDSSpeechSynthesizer=e()}(this,function(){"use strict";function t(){return"_s_"+u++}function e(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function n(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;10>n;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map(function(t){return e[t]});if("0123456789"!==r.join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},i)).join("")?!1:!0}catch(o){return!1}}function r(t,e){return e.encode?e.strict?l(t):encodeURIComponent(t):t}var i=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,i){var s={key:t,arg:e,resolve:n,reject:i,next:null};u?u=u.next=s:(o=u=s,r(t,e))})}function r(n,o){try{var u=e[n](o),s=u.value;s instanceof t?Promise.resolve(s.value).then(function(t){r("next",t)},function(t){r("throw",t)}):i(u.done?"return":"normal",u.value)}catch(a){i("throw",a)}}function i(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?r(o.key,o.arg):u=null}var o,u;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=1,s=function(){function e(n){return i(this,e),this.options={src:"",autoplay:!0},this.id=t(),Object.assign(this.options,n),e.getAudio(this.options.src),n.autoplay?(this.play(),this):this}return o(e,[{key:"on",value:function(t,n){return e.event.on(this.id,t,n),this}},{key:"once",value:function(t,n){return e.event.once(this.id,t,n),this}},{key:"off",value:function(t,n){return e.event.off(this.id,t,n),this}},{key:"play",value:function(){var t=e.getAudio(this.options.src);return t.id=this.id,t.play(),this}},{key:"stop",value:function(){return e.stop(),this}}],[{key:"getAudio",value:function(t){var e;return this.node?e=this.node:(e=new Audio,e.preload="auto",this.node=e),t&&(e.src=t),e}},{key:"stop",value:function(){var t=e.getAudio();return t.pause(),t.currentTime=0,t}},{key:"enableMobileAudio",value:function(){function t(){var n=e.getAudio();n.play(),n.pause(),e.mobileAudioEnabled=!0,document.removeEventListener("touchstart",t,!0)}var n=navigator.userAgent,r=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(n),i=!!("ontouchend"in window);r&&i&&!this.mobileAudioEnabled&&document.addEventListener("touchstart",t,!0)}}]),e}();s.event={_events:{},_proxy:{},dispach:function(t,e){var n=this._events[t];Object.keys(n).forEach(function(t){t===e&&n[t].forEach(function(t){t()})})},on:function(t,e,n){if(!this._proxy[e]){var r=s.getAudio();this._proxy[e]=r.addEventListener(e,this.dispach.bind(this,e,r.id))}this._events[e]=this._events[e]||{},this._events[e][t]=this._events[e][t]||[],this._events[e][t].push(n)},once:function(t,e,n){function r(){n(),this.off(t,e,n)}r.fn=n,this.on(t,e,r.bind(this))},off:function(t,e,n){if(0===arguments.length){this._events={};var r=s.getAudio(),i=this._proxy;return Object.keys(i).forEach(function(t){r.removeEventListener(t)}),this._proxy={},this}if(!this._proxy[e])return this;if(!this._events[e])return this;var o=this._events[e][t];if(!o)return this;for(var u,a=0;a<o.length;a++)if(u=o[a],u===n||u.fn===n){o.splice(a,1);break}}};var a=function(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})},c=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,h=n()?Object.assign:function(t){for(var n,r,i=e(t),o=1;o<arguments.length;o++){n=Object(arguments[o]);for(var u in n)c.call(n,u)&&(i[u]=n[u]);if(Object.getOwnPropertySymbols){r=Object.getOwnPropertySymbols(n);for(var s=0;s<r.length;s++)f.call(n,r[s])&&(i[r[s]]=n[r[s]])}}return i},l=a,p=h,v=function(t,e){var n={encode:!0,strict:!0};return e=p(n,e),t?Object.keys(t).sort().map(function(n){var i=t[n];if(void 0===i)return"";if(null===i)return r(n,e);if(Array.isArray(i)){var o=[];return i.slice().forEach(function(t){void 0!==t&&o.push(null===t?r(n,e):r(n,e)+"="+r(t,e))}),o.join("&")}return r(n,e)+"="+r(i,e)}).filter(function(t){return t.length>0}).join("&"):""},d=function(){function t(e){i(this,t),this.speakers={},this.options={lan:"zh",cuid:"baidu_speech_demo",spd:"5",pit:"5",vol:"5",per:"0",ctp:"1",pdt:"1"},Object.assign(this.options,e),s.enableMobileAudio()}return o(t,[{key:"synthesize",value:function(e,n){var r=Object.assign({},this.options,{tex:e},n);return t.SERVER_URL+v(r)}},{key:"getSpeaker",value:function(t,e){var n=this.speakers[t];if(n)return n;var r=Object.assign({src:t},e);return n=new s(r),this.speakers[t]=n,n}},{key:"speak",value:function(t,e,n){var r=this.synthesize(t,e),i=this.getSpeaker(r,n);return n&&n.autoplay===!1?i:(i.play(),i)}},{key:"stop",value:function(){s.stop()}}]),t}();return d.SERVER_URL="http://tts.baidu.com/text2audio?",d});